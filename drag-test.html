<!DOCTYPE html>
<html>
<head>
  <title>Drag Test</title>
  <style>
    #canvas {
      width: 800px;
      height: 600px;
      border: 1px solid #ccc;
      position: relative;
      background-color: #f0f0f0;
    }
    .gate {
      width: 50px;
      height: 50px;
      background-color: blue;
      border-radius: 25px;
      position: absolute;
      cursor: move;
      transition: opacity 0.2s;
    }
    .gate.dragging {
      opacity: 0.5;
    }
  </style>
</head>
<body>
  <div id="canvas">
    <div class="gate" id="gate1" style="left: 100px; top: 100px;"></div>
    <div class="gate" id="gate2" style="left: 200px; top: 200px;"></div>
  </div>
  
  <script>
    let draggedGate = null;
    let dragOffset = { x: 0, y: 0 };
    
    document.querySelectorAll('.gate').forEach(gate => {
      gate.addEventListener('mousedown', (e) => {
        draggedGate = gate;
        const rect = gate.getBoundingClientRect();
        const canvasRect = document.getElementById('canvas').getBoundingClientRect();
        dragOffset.x = e.clientX - rect.left;
        dragOffset.y = e.clientY - rect.top;
        gate.classList.add('dragging');
        e.preventDefault();
      });
    });
    
    document.addEventListener('mousemove', (e) => {
      if (draggedGate) {
        const canvasRect = document.getElementById('canvas').getBoundingClientRect();
        const newX = e.clientX - canvasRect.left - dragOffset.x;
        const newY = e.clientY - canvasRect.top - dragOffset.y;
        
        // スナップ
        const snappedX = Math.round(newX / 20) * 20;
        const snappedY = Math.round(newY / 20) * 20;
        
        draggedGate.style.left = snappedX + 'px';
        draggedGate.style.top = snappedY + 'px';
      }
    });
    
    document.addEventListener('mouseup', () => {
      if (draggedGate) {
        draggedGate.classList.remove('dragging');
        draggedGate = null;
      }
    });
  </script>
</body>
</html>