name: "ğŸ›¡ï¸ Basic Quality Gate"

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

jobs:
  basic-quality-gate:
    name: "Basic Quality Checks"
    runs-on: ubuntu-latest
    timeout-minutes: 10

    steps:
      - name: "ğŸ“¥ Checkout Code"
        uses: actions/checkout@v4

      - name: "ğŸ“¦ Setup pnpm"
        uses: pnpm/action-setup@v4
        with:
          version: 8

      - name: "âš¡ Setup Node.js"
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'pnpm'

      - name: "ğŸ“š Install Dependencies"
        run: pnpm install --frozen-lockfile

      - name: "ğŸ” Type Safety Check"
        id: typecheck
        run: |
          echo "ğŸ”¬ Running TypeScript type checking..."
          pnpm run typecheck
          echo "âœ… TypeScript check passed"

      - name: "ğŸ“ Code Quality Check"
        id: lint
        run: |
          echo "ğŸ“ Running ESLint..."
          pnpm run lint
          echo "âœ… Linting passed"

      - name: "ğŸ§ª Ideal Tests Execution"
        id: ideal-tests
        run: |
          echo "ğŸ§ª Running Ideal Tests..."
          pnpm run test tests/core/ tests/adapters/ --run
          echo "âœ… Ideal tests passed"

      - name: "ğŸ“Š Basic Quality Metrics"
        if: always()
        run: |
          echo "=== BASIC QUALITY GATE REPORT ==="
          echo "TypeScript Status: ${{ steps.typecheck.outcome }}"
          echo "Linting Status: ${{ steps.lint.outcome }}"
          echo "Ideal Tests Status: ${{ steps.ideal-tests.outcome }}"
          echo "Timestamp: $(date -u +"%Y-%m-%d %H:%M:%S UTC")"
          echo "=================================="

      - name: "âœ… Quality Gate Result"
        if: failure()
        run: |
          echo "âŒ BASIC QUALITY GATE FAILED"
          echo "Please fix the issues above before proceeding."
          exit 1

  quality-gate-summary:
    name: "ğŸ“‹ Quality Gate Summary" 
    runs-on: ubuntu-latest
    needs: basic-quality-gate
    if: always()

    steps:
      - name: "ğŸ“Š Generate Summary"
        run: |
          if [ "${{ needs.basic-quality-gate.result }}" == "success" ]; then
            echo "ğŸ‰ BASIC QUALITY GATE: PASSED"
            echo "âœ… All basic quality checks successful"
            echo "âœ… TypeScript type safety confirmed"
            echo "âœ… Code quality standards met"
            echo "âœ… Ideal tests protecting core functionality"
          else
            echo "âŒ BASIC QUALITY GATE: FAILED"
            echo "Please review and fix the quality issues."
          fi