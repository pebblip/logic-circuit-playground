# LogiCirc - 強制品質保証ガイド

## 🚨 絶対遵守事項

**このドキュメントの全項目は提案ではなく、絶対的なルールです。**  
**違反した場合は即座に作業を停止し、ルール準拠状態に復旧してから継続してください。**

---

## 🎯 プロジェクト概要

教育用論理回路シミュレータの開発手順と品質管理方法を記載します。実際の開発で発生した問題の対策と予防方法をまとめています。

### 📋 最新のテスト戦略

機能カバレッジ重視の包括的テスト体系を採用しています。  
詳細は [テスト戦略ドキュメント v3.0](docs/testing/TEST_STRATEGY.md) を参照してください。

### 核心機能

- インタラクティブな論理回路設計環境
- リアルタイム回路シミュレーション
- 教育用学習モードとギャラリー機能
- 高度なカスタムゲート作成機能

---

## 🏗️ 強制開発フロー

### 基本原則（違反禁止）

1. **品質優先**: 動作する確実な機能を段階的に構築
2. **予防的思考**: 問題の発生を事前に防ぐ設計
3. **継続的検証**: 全ての変更に対する多層的な確認
4. **謙虚な姿勢**: 完璧は存在しない前提での開発

---

## 🚨 段階的品質ゲートシステム

### **ゲート1: 設計完了の必須条件**

以下の**全項目完了後**のみ実装開始可能

- [ ] **要件定義完了**: 何を作るかが明確
- [ ] **アーキテクチャ設計完了**: どう作るかが明確
- [ ] **型定義完了**: インターフェースが明確
- [ ] **テスト戦略策定**: どうテストするかが明確

**⚠️ ゲート1未通過での実装開始は絶対禁止**

### **ゲート2: 実装完了の必須条件**

以下の**全項目完了後**のみ次機能開始可能

- [ ] **TypeScriptエラー0件**: `npm run typecheck` 成功
- [ ] **基本テスト作成**: 最低限のunit test作成
- [ ] **ESLintエラー0件**: `npm run lint` 成功（該当する場合）
- [ ] **手動動作確認3分**: ブラウザでの基本動作確認
- [ ] **コミット前確認**: 変更内容の妥当性確認

**⚠️ ゲート2未通過での次機能開始は絶対禁止**

### **ゲート3: リリース完了の必須条件**

以下の**全項目完了後**のみリリース可能

- [ ] **全テストスイート通過**: `npm run test` 成功
- [ ] **統合テスト通過**: コンポーネント間連携確認
- [ ] **回帰テスト通過**: 既存機能の動作保証
- [ ] **手動E2Eテスト**: 主要フローの完全確認
- [ ] **パフォーマンス確認**: 重大な性能劣化なし

**⚠️ ゲート3未通過でのリリースは絶対禁止**

---

## 🔒 必須テスト戦略

### **Level 1: 構造テスト（必須）**

```typescript
describe('新機能の構造テスト', () => {
  it('✅ 必須: データ整合性が正しい', () => {
    // 型定義、設定値、インターフェースの整合性
  });

  it('✅ 必須: エラーハンドリングが完全', () => {
    // 全エラーケースの適切な処理
  });
});
```

### **Level 2: 動作テスト（必須）**

```typescript
describe('新機能の動作テスト', () => {
  it('✅ 必須: 正常系フローが動作', () => {
    // 期待される動作の確認
  });

  it('✅ 必須: 異常系フローが安全', () => {
    // エラー時の安全な動作確認
  });
});
```

### **Level 3: 統合テスト（必須）**

```typescript
describe('新機能の統合テスト', () => {
  it('✅ 必須: 既存機能と連携', () => {
    // 他コンポーネントとの連携確認
  });

  it('✅ 必須: 既存機能に影響なし', () => {
    // 回帰テスト、副作用確認
  });
});
```

**⚠️ 上記3レベル未完了での次段階移行は絶対禁止**

---

## 🛡️ 強制コード品質基準

### **データ・ロジック統合原則（強制）**

```typescript
// ✅ 必須パターン: 設定とデータの統合
export const UNIFIED_SYSTEM = {
  id: 'feature-name',
  data: {
    /* データ */
  },
  config: {
    /* 設定 */
  },
  validation: {
    /* 検証ルール */
  },
  tests: {
    /* テスト仕様 */
  },
};

// ❌ 絶対禁止: 設定の分散配置
// 複数ファイルにハードコーディング
// 型安全性のない any 使用
// テストのない実装
```

### **型安全性の徹底（強制）**

```typescript
// ✅ 必須: 厳密な型定義
interface StrictInterface {
  required: string;
  optional?: number;
}

// ❌ 絶対禁止パターン
// any 型の使用
// unknown の不適切な使用
// 型アサーションの乱用
```

---

## 🚨 違反検出と強制復旧

### **ルール違反の検出**

1. **TypeScriptエラー検出時**
   → 即座に作業停止、エラー解消まで進行禁止

2. **テスト未作成検出時**
   → 即座に作業停止、テスト作成まで進行禁止

3. **any型使用検出時**
   → 即座に作業停止、型安全化まで進行禁止

### **強制復旧手順**

```bash
# 1. 現状確認
npm run typecheck  # TypeScriptエラー確認
npm run test       # テスト状況確認
npm run lint       # コード品質確認

# 2. 違反箇所の特定と修正
# 3. 全ゲート条件の再確認
# 4. 合格後に作業再開
```

---

## 📋 作業開始時の必須チェックリスト

### **セッション開始時（必須実行）**

- [ ] `git status` で現状確認
- [ ] `npm run typecheck` でエラーなし確認
- [ ] `npm run test` でテスト状況確認
- [ ] `docs/management/PROGRESS.md` で進捗確認
- [ ] 今回の作業目標の明確化

### **機能実装開始時（必須実行）**

- [ ] 要件定義の文書化
- [ ] 型定義の作成
- [ ] テスト戦略の策定
- [ ] 実装アプローチの検証

### **機能実装完了時（必須実行）**

- [ ] TypeScriptエラー0件確認
- [ ] 基本テスト作成・実行
- [ ] 手動動作確認（最低3分間）
- [ ] エラーケースの動作確認
- [ ] 関連機能への影響確認

---

## 🎯 段階的開発の強制実行

### **小機能単位での完結（必須）**

1. **要件定義** → **設計** → **実装** → **テスト** → **確認** を1セットで完結
2. 1機能の作業時間は最大2時間以内
3. 各段階でのゲート通過を必須とする

### **継続的統合の強制実行（必須）**

- 30分ごとの進捗確認
- 1時間ごとのTypeScriptエラーチェック
- 2時間ごとのテスト実行
- 機能完了時の全体動作確認

---

## 🔧 ツールによる強制チェック

### **品質チェックコマンド（作業前必須）**

```bash
# 総合品質確認（必須）
npm run typecheck && npm run test && npm run lint

# 特定領域の確認
npm run validate:gallery    # ギャラリー回路
npm run test:unit          # 単体テスト
npm run test:integration   # 統合テスト
```

### **段階別確認コマンド**

```bash
# ゲート1通過確認
echo "設計完了チェック: 要件・アーキテクチャ・型定義・テスト戦略"

# ゲート2通過確認
npm run typecheck && npm run lint && echo "基本テスト実行・手動確認"

# ゲート3通過確認
npm run test && echo "統合テスト・回帰テスト・E2Eテスト"
```

---

## 🚨 エマージェンシープロトコル

### **重大品質問題発生時**

1. **即座に作業停止**
2. **問題の範囲特定**
3. **影響度評価**
4. **復旧計画策定**
5. **段階的復旧実行**
6. **再発防止策実装**

### **ルール違反発生時**

1. **作業即時停止**
2. **違反箇所の特定**
3. **ルール準拠状態への復旧**
4. **再発防止の仕組み追加**
5. **ガイドライン改善**

---

## 📖 実践的開発手順

### **新機能開発の必須フロー**

```
1. 要件定義 (ゲート1-1)
   ↓
2. アーキテクチャ設計 (ゲート1-2)
   ↓
3. 型定義作成 (ゲート1-3)
   ↓
4. テスト戦略策定 (ゲート1-4)
   ↓
   [ゲート1通過判定]
   ↓
5. 実装開始
   ↓
6. 基本テスト作成 (並行)
   ↓
7. TypeScript/ESLintエラー解消
   ↓
8. 手動動作確認
   ↓
   [ゲート2通過判定]
   ↓
9. 統合テスト作成・実行
   ↓
10. 回帰テスト実行
    ↓
11. E2E確認
    ↓
    [ゲート3通過判定]
    ↓
12. リリース可能
```

**⚠️ 各ゲートで不合格の場合、前段階に強制的に戻る**

---

## 🎉 品質文化の徹底

### **品質に対する姿勢（絶対遵守）**

- ✅ **高品質を目指し、不完全さを受け入れる**
- ✅ **自動化を活用し、人的確認を怠らない**
- ✅ **過去の成功に慢心せず、新たなリスクに警戒する**
- ✅ **問題を隠さず、学習機会として活用する**

### **継続的改善（必須実行）**

- 週次での品質メトリクス確認
- 月次でのプロセス改善
- 問題発生時の即座の原因分析と対策
- ガイドライン自体の継続的更新

---

## 🔄 このガイドライン自体の改善

### **更新タイミング**

- ルール違反が発生した場合 → 即座に更新
- 新しい問題パターンを発見した場合 → 即座に更新
- より効果的な手順を発見した場合 → 即座に更新

### **更新原則**

- より強制力を持つ方向での改善
- より実践的で使いやすい方向での改善
- より明確で曖昧さのない方向での改善

---

---

## 🚨 次のセッション緊急指示（2025-06-23）

### **📊 現在の完璧な状態**

- ✅ Foundation完了: 型統一100%達成（EvaluationGate→Gate完了）
- ✅ Critical Fix完了: ギャラリー動作不良修正（1行修正で解決）
- ✅ 品質状態: 623 passed | 211 skipped | **失敗0件**
- ✅ TypeScript・ESLint: エラー0件

### **🎯 次のタスク（優先度順）**

#### **🔧 Phase 3: UI一貫性修正（簡単作業）**

```bash
# 1. 用語統一（INPUT/OUTPUT表記揺れ）
# 2. パネル伸縮問題修正（ズーム%、遅延モード）
# 3. デバッグログボックス削除（右下の不要表示）
```

#### **🔧 Phase 4: 操作性改善（中程度作業）**

```bash
# 1. INPUT ゲート当たり判定拡大
# 2. ズームボタン動作修正
# 3. ギャラリーモードパン操作有効化
# 4. 接続線削除UX改善
```

### **⚠️ 絶対に避けること**

- useCanvasの大規模リファクタリング（不要確認済み）
- シミュレーションエンジンの変更（完全正常動作）
- 型システムの変更（100%完成済み）

### **✅ 各修正後の必須チェック**

```bash
npm run test && npm run typecheck && npm run lint
```

---

**最終更新: 2025-06-23 | Foundation & Critical Fix完了。次は細かいUX改善フェーズ**

**⚠️ 再重要: このガイドラインは「参考」ではなく「絶対遵守事項」です**
