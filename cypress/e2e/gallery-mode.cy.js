describe('ã‚®ãƒ£ãƒ©ãƒªãƒ¼ãƒ¢ãƒ¼ãƒ‰ E2E ãƒ†ã‚¹ãƒˆ', () => {
  beforeEach(() => {
    cy.visit('/');
  });

  describe('ã‚®ãƒ£ãƒ©ãƒªãƒ¼ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ', () => {
    it('ã‚®ãƒ£ãƒ©ãƒªãƒ¼ãƒ¢ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã‚®ãƒ£ãƒ©ãƒªãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹', () => {
      // ã‚®ãƒ£ãƒ©ãƒªãƒ¼ãƒ¢ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
      cy.contains('ã‚®ãƒ£ãƒ©ãƒªãƒ¼ãƒ¢ãƒ¼ãƒ‰').click();
      
      // ã‚®ãƒ£ãƒ©ãƒªãƒ¼ã®ã‚¿ã‚¤ãƒˆãƒ«ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      cy.contains('ğŸ“š å›è·¯ã‚®ãƒ£ãƒ©ãƒªãƒ¼').should('be.visible');
      
      // ã‚µã‚¤ãƒ‰ãƒãƒ¼ãŒéè¡¨ç¤ºã«ãªã‚‹ã“ã¨ã‚’ç¢ºèª
      cy.get('.sidebar-left').should('not.exist');
      cy.get('.sidebar-right').should('not.exist');
    });

    it('ä»–ã®ãƒ¢ãƒ¼ãƒ‰ã‹ã‚‰ã‚®ãƒ£ãƒ©ãƒªãƒ¼ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã‚‹', () => {
      // æœ€åˆã«ãƒ•ãƒªãƒ¼ãƒ¢ãƒ¼ãƒ‰ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
      cy.contains('ãƒ•ãƒªãƒ¼ãƒ¢ãƒ¼ãƒ‰').should('have.class', 'active');
      
      // ã‚®ãƒ£ãƒ©ãƒªãƒ¼ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ
      cy.contains('ã‚®ãƒ£ãƒ©ãƒªãƒ¼ãƒ¢ãƒ¼ãƒ‰').click();
      
      // ã‚®ãƒ£ãƒ©ãƒªãƒ¼ãƒ¢ãƒ¼ãƒ‰ãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ãªã‚‹ã“ã¨ã‚’ç¢ºèª
      cy.contains('ã‚®ãƒ£ãƒ©ãƒªãƒ¼ãƒ¢ãƒ¼ãƒ‰').should('have.class', 'active');
      cy.contains('ğŸ“š å›è·¯ã‚®ãƒ£ãƒ©ãƒªãƒ¼').should('be.visible');
    });
  });

  describe('å›è·¯ã‚«ãƒ†ã‚´ãƒªè¡¨ç¤º', () => {
    beforeEach(() => {
      cy.contains('ã‚®ãƒ£ãƒ©ãƒªãƒ¼ãƒ¢ãƒ¼ãƒ‰').click();
    });

    it('3ã¤ã®ã‚«ãƒ†ã‚´ãƒªãŒè¡¨ç¤ºã•ã‚Œã‚‹', () => {
      cy.contains('ğŸ”„ å¾ªç’°å›è·¯').should('be.visible');
      cy.contains('âš¡ é«˜åº¦å›è·¯').should('be.visible');
      cy.contains('ğŸ”§ åŸºæœ¬å›è·¯').should('be.visible');
    });

    it('å¾ªç’°å›è·¯ã‚«ãƒ†ã‚´ãƒªã«æ–°ã—ã„å›è·¯ãŒè¡¨ç¤ºã•ã‚Œã‚‹', () => {
      // å›è·¯ã‚«ãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      cy.get('.circuit-card.cyclical').should('have.length.greaterThan', 0);
      
      // æœ€ä½é™ã€ä¸€ã¤ã®å¾ªç’°å›è·¯ã‚¿ã‚¤ãƒˆãƒ«ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã‚’ç¢ºèª
      cy.get('.circuit-title').should('contain.text', 'ã‚«ã‚ªã‚¹ç™ºç”Ÿå™¨');
    });
  });

  describe('å›è·¯èª­ã¿è¾¼ã¿æ©Ÿèƒ½', () => {
    beforeEach(() => {
      cy.contains('ã‚®ãƒ£ãƒ©ãƒªãƒ¼ãƒ¢ãƒ¼ãƒ‰').click();
    });

    it('å›è·¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨è©³ç´°ãŒè¡¨ç¤ºã•ã‚Œã‚‹', () => {
      // æœ€åˆã®å¾ªç’°å›è·¯ã®èª­ã¿è¾¼ã¿ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
      cy.get('.circuit-card.cyclical').first().find('.load-button').click();
      
      // é¸æŠã•ã‚ŒãŸå›è·¯ã®è©³ç´°æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      cy.get('.selected-circuit').should('be.visible');
      
      // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒå®Œäº†ã™ã‚‹ã¾ã§å¾…æ©Ÿï¼ˆæœ€å¤§ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³æ™‚é–“: 0.7s + 0.6s = 1.3sï¼‰
      cy.wait(1500);
      
      // ãƒœã‚¿ãƒ³ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã‚’ç¢ºèªï¼ˆvisibility ãƒã‚§ãƒƒã‚¯ã¯é¿ã‘ã‚‹ï¼‰
      cy.get('.edit-button').should('exist');
      cy.get('.back-button').should('exist');
      
      // ãƒœã‚¿ãƒ³ã®ãƒ†ã‚­ã‚¹ãƒˆãŒæ­£ã—ã„ã“ã¨ã‚’ç¢ºèª
      cy.contains('ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã§é–‹ã').should('exist');
      cy.contains('ã‚®ãƒ£ãƒ©ãƒªãƒ¼ã«æˆ»ã‚‹').should('exist');
    });

    it('ç·¨é›†ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ãƒ•ãƒªãƒ¼ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ã‚ã‚‹', () => {
      // å›è·¯ã‚’é¸æŠ
      cy.get('.circuit-card.cyclical').first().find('.load-button').click();
      
      // ç·¨é›†ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
      cy.contains('ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã§é–‹ã').click();
      
      // ãƒ•ãƒªãƒ¼ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
      cy.contains('ãƒ•ãƒªãƒ¼ãƒ¢ãƒ¼ãƒ‰').should('have.class', 'active');
    });

    it('æˆ»ã‚‹ãƒœã‚¿ãƒ³ã§ã‚®ãƒ£ãƒ©ãƒªãƒ¼ä¸€è¦§ã«æˆ»ã‚‹', () => {
      // å›è·¯ã‚’é¸æŠ
      cy.get('.circuit-card.cyclical').first().find('.load-button').click();
      
      // æˆ»ã‚‹ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
      cy.contains('ã‚®ãƒ£ãƒ©ãƒªãƒ¼ã«æˆ»ã‚‹').click();
      
      // ã‚®ãƒ£ãƒ©ãƒªãƒ¼ä¸€è¦§ã«æˆ»ã‚‹ã“ã¨ã‚’ç¢ºèª
      cy.contains('ğŸ“š å›è·¯ã‚®ãƒ£ãƒ©ãƒªãƒ¼').should('be.visible');
      cy.contains('ğŸ”„ å¾ªç’°å›è·¯').should('be.visible');
    });
  });

  describe('ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³', () => {
    beforeEach(() => {
      cy.contains('ã‚®ãƒ£ãƒ©ãƒªãƒ¼ãƒ¢ãƒ¼ãƒ‰').click();
    });

    it('ãƒ¢ãƒã‚¤ãƒ«ã‚µã‚¤ã‚ºã§é©åˆ‡ã«è¡¨ç¤ºã•ã‚Œã‚‹', () => {
      cy.viewport(375, 667); // iPhone SE ã‚µã‚¤ã‚º
      
      // ã‚®ãƒ£ãƒ©ãƒªãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      cy.contains('ğŸ“š å›è·¯ã‚®ãƒ£ãƒ©ãƒªãƒ¼').should('be.visible');
      
      // å›è·¯ã‚°ãƒªãƒƒãƒ‰ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã‚’ç¢ºèª
      cy.get('.circuits-grid').should('exist');
    });

    it('ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆã‚µã‚¤ã‚ºã§é©åˆ‡ã«è¡¨ç¤ºã•ã‚Œã‚‹', () => {
      cy.viewport(768, 1024); // iPad ã‚µã‚¤ã‚º
      
      // ã‚®ãƒ£ãƒ©ãƒªãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      cy.contains('ğŸ“š å›è·¯ã‚®ãƒ£ãƒ©ãƒªãƒ¼').should('be.visible');
      
      // ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãŒé©åˆ‡ã«èª¿æ•´ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      cy.get('.gallery-panel').should('be.visible');
    });
  });

  describe('ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°', () => {
    it('ä¸æ­£ãªå›è·¯ãƒ‡ãƒ¼ã‚¿ã§ã‚‚ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã—ãªã„', () => {
      cy.contains('ã‚®ãƒ£ãƒ©ãƒªãƒ¼ãƒ¢ãƒ¼ãƒ‰').click();
      
      // ãƒšãƒ¼ã‚¸ãŒã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã—ã¦ã„ãªã„ã“ã¨ã‚’ç¢ºèª
      cy.contains('ğŸ“š å›è·¯ã‚®ãƒ£ãƒ©ãƒªãƒ¼').should('be.visible');
      
      // å›è·¯èª­ã¿è¾¼ã¿ã‚’è©¦è¡Œ
      cy.get('.circuit-card').first().should('exist');
      
      // ã‚®ãƒ£ãƒ©ãƒªãƒ¼ãŒå¼•ãç¶šãè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      cy.contains('ğŸ“š å›è·¯ã‚®ãƒ£ãƒ©ãƒªãƒ¼').should('be.visible');
    });
  });

  describe('ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£', () => {
    beforeEach(() => {
      cy.contains('ã‚®ãƒ£ãƒ©ãƒªãƒ¼ãƒ¢ãƒ¼ãƒ‰').click();
    });

    it('ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãŒå¯èƒ½', () => {
      // å›è·¯ã‚«ãƒ¼ãƒ‰ã®ãƒœã‚¿ãƒ³ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹å¯èƒ½
      cy.get('.load-button').first().focus();
      cy.focused().should('contain', 'ã‚­ãƒ£ãƒ³ãƒã‚¹ã§é–‹ã');
    });

    it('é©åˆ‡ãªARIAãƒ©ãƒ™ãƒ«ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹', () => {
      // ãƒ˜ãƒƒãƒ€ãƒ¼ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã‚’ç¢ºèª
      cy.get('h1').should('exist').and('not.be.empty');
      
      // ãƒœã‚¿ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚·ãƒ–ãƒ«ãªåå‰ãŒã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
      cy.get('.load-button').each(($button) => {
        cy.wrap($button).should('contain.text', 'ã‚­ãƒ£ãƒ³ãƒã‚¹ã§é–‹ã');
      });
    });
  });
});