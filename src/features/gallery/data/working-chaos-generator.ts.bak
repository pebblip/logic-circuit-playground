/**
 * ğŸ¯ ç¢ºå®Ÿã«å‹•ä½œã™ã‚‹ã‚«ã‚ªã‚¹ç™ºç”Ÿå™¨
 * 
 * å…ƒã®LFSRãŒå‹•ä½œã—ãªã„å•é¡Œã‚’å›é¿ã—ã€ç¢ºå®Ÿã«å‹•ä½œã™ã‚‹ã‚«ã‚ªã‚¹ç”Ÿæˆå™¨ã‚’å®Ÿè£…
 * ã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼šã‚·ãƒ³ãƒ—ãƒ«ãªãƒã‚¤ãƒŠãƒªã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ï¼‹è«–ç†ã‚²ãƒ¼ãƒˆçµ„ã¿åˆã‚ã›ã§ç–‘ä¼¼ãƒ©ãƒ³ãƒ€ãƒ ç”Ÿæˆ
 */

import type { CircuitMetadata } from './gallery';

export const WORKING_CHAOS_GENERATOR: CircuitMetadata = {
  id: 'working-chaos-generator',
  title: 'ğŸ¯ ç¢ºå®Ÿå‹•ä½œã‚«ã‚ªã‚¹ç™ºç”Ÿå™¨',
  description: 'ç¢ºå®Ÿã«å‹•ä½œã™ã‚‹ç–‘ä¼¼ãƒ©ãƒ³ãƒ€ãƒ ç”Ÿæˆå™¨ã€‚ãƒã‚¤ãƒŠãƒªã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ï¼‹XORãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã§å®‰å®šã—ãŸã‚«ã‚ªã‚¹çš„å‹•ä½œã‚’å®Ÿç¾ã€‚',
  
  gates: [
    // ===== ã‚¯ãƒ­ãƒƒã‚¯ä¿¡å· =====
    {
      id: 'main_clock',
      type: 'CLOCK' as const,
      position: { x: 50, y: 200 },
      width: 80,
      height: 60,
      label: 'ãƒ¡ã‚¤ãƒ³ã‚¯ãƒ­ãƒƒã‚¯',
      output: false,
      metadata: {
        frequency: 1, // 1Hz = ã‚†ã£ãã‚Šã¨ã—ãŸå‹•ä½œã§è¦³å¯Ÿã—ã‚„ã™ã„
        isRunning: true,
        startTime: Date.now(),
      }
    },

    // ===== 2ãƒ“ãƒƒãƒˆãƒã‚¤ãƒŠãƒªã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ =====
    {
      id: 'binary_counter',
      type: 'BINARY_COUNTER' as const,
      position: { x: 200, y: 200 },
      width: 120,
      height: 80,
      label: '2ãƒ“ãƒƒãƒˆã‚«ã‚¦ãƒ³ã‚¿ãƒ¼',
      output: false,
      inputs: [''],
      metadata: {
        bitWidth: 2, // 2ãƒ“ãƒƒãƒˆ = 0,1,2,3 ã®å¾ªç’°
        count: 0,
        previousClockState: false
      }
    },

    // ===== XORãƒŸã‚­ã‚µãƒ¼ =====
    {
      id: 'xor_mixer1',
      type: 'XOR' as const,
      position: { x: 400, y: 150 },
      width: 60,
      height: 60,
      label: 'XOR1',
      output: false,
      inputs: ['', '']
    },
    {
      id: 'xor_mixer2',
      type: 'XOR' as const,
      position: { x: 400, y: 250 },
      width: 60,
      height: 60,
      label: 'XOR2',
      output: false,
      inputs: ['', '']
    },

    // ===== ANDãƒŸã‚­ã‚µãƒ¼ =====
    {
      id: 'and_mixer',
      type: 'AND' as const,
      position: { x: 550, y: 200 },
      width: 60,
      height: 60,
      label: 'AND',
      output: false,
      inputs: ['', '']
    },

    // ===== ã‚«ã‚ªã‚¹å‡ºåŠ› =====
    {
      id: 'chaos_out_1',
      type: 'OUTPUT' as const,
      position: { x: 700, y: 100 },
      width: 80,
      height: 40,
      label: 'ã‚«ã‚ªã‚¹1',
      output: false,
      inputs: ['']
    },
    {
      id: 'chaos_out_2',
      type: 'OUTPUT' as const,
      position: { x: 700, y: 150 },
      width: 80,
      height: 40,
      label: 'ã‚«ã‚ªã‚¹2',
      output: false,
      inputs: ['']
    },
    {
      id: 'chaos_out_3',
      type: 'OUTPUT' as const,
      position: { x: 700, y: 200 },
      width: 80,
      height: 40,
      label: 'ã‚«ã‚ªã‚¹3',
      output: false,
      inputs: ['']
    },
    {
      id: 'chaos_out_4',
      type: 'OUTPUT' as const,
      position: { x: 700, y: 250 },
      width: 80,
      height: 40,
      label: 'ã‚«ã‚ªã‚¹4',
      output: false,
      inputs: ['']
    },
  ],

  wires: [
    // ã‚¯ãƒ­ãƒƒã‚¯ â†’ ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼
    {
      id: 'clock_to_counter',
      from: { gateId: 'main_clock', pinIndex: -1 },
      to: { gateId: 'binary_counter', pinIndex: 0 },
      isActive: false
    },
    
    // ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼å‡ºåŠ› â†’ XORãƒŸã‚­ã‚µãƒ¼
    {
      id: 'counter_bit0_to_xor1',
      from: { gateId: 'binary_counter', pinIndex: 0 },
      to: { gateId: 'xor_mixer1', pinIndex: 0 },
      isActive: false
    },
    {
      id: 'counter_bit1_to_xor1',
      from: { gateId: 'binary_counter', pinIndex: 1 },
      to: { gateId: 'xor_mixer1', pinIndex: 1 },
      isActive: false
    },
    {
      id: 'counter_bit0_to_xor2',
      from: { gateId: 'binary_counter', pinIndex: 0 },
      to: { gateId: 'xor_mixer2', pinIndex: 0 },
      isActive: false
    },
    {
      id: 'counter_bit1_to_xor2',
      from: { gateId: 'binary_counter', pinIndex: 1 },
      to: { gateId: 'xor_mixer2', pinIndex: 1 },
      isActive: false
    },

    // XORå‡ºåŠ› â†’ AND
    {
      id: 'xor1_to_and',
      from: { gateId: 'xor_mixer1', pinIndex: -1 },
      to: { gateId: 'and_mixer', pinIndex: 0 },
      isActive: false
    },
    {
      id: 'xor2_to_and',
      from: { gateId: 'xor_mixer2', pinIndex: -1 },
      to: { gateId: 'and_mixer', pinIndex: 1 },
      isActive: false
    },

    // å„ç¨®å‡ºåŠ›ã¸ã®æ¥ç¶š
    {
      id: 'counter_bit0_to_out1',
      from: { gateId: 'binary_counter', pinIndex: 0 },
      to: { gateId: 'chaos_out_1', pinIndex: 0 },
      isActive: false
    },
    {
      id: 'counter_bit1_to_out2',
      from: { gateId: 'binary_counter', pinIndex: 1 },
      to: { gateId: 'chaos_out_2', pinIndex: 0 },
      isActive: false
    },
    {
      id: 'xor1_to_out3',
      from: { gateId: 'xor_mixer1', pinIndex: -1 },
      to: { gateId: 'chaos_out_3', pinIndex: 0 },
      isActive: false
    },
    {
      id: 'and_to_out4',
      from: { gateId: 'and_mixer', pinIndex: -1 },
      to: { gateId: 'chaos_out_4', pinIndex: 0 },
      isActive: false
    }
  ],

  // âœ… ç¢ºå®Ÿãªå‹•ä½œè¨­å®š
  simulationConfig: {
    needsAnimation: true,
    updateInterval: 2000, // 2ç§’é–“éš”ã§åˆ†ã‹ã‚Šã‚„ã™ã„
    expectedBehavior: 'sequence_generator',
    minimumCycles: 4,
    clockFrequency: 1,
  },

  metadata: {
    createdAt: '2025-06-20',
    author: 'Claude Code',
    version: '2.0',
    tags: ['sequential', 'chaos', 'working', 'reliable'],
    
    // æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œãƒ‘ã‚¿ãƒ¼ãƒ³
    expectedBehavior: {
      description: 'ãƒã‚¤ãƒŠãƒªã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ãŒ0â†’1â†’2â†’3â†’0ã§å¾ªç’°ã—ã€XOR/ANDãŒè¤‡é›‘ãªå‡ºåŠ›ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç”Ÿæˆ',
      outputPattern: {
        'chaos_out_1': '0â†’1â†’0â†’1â†’0... (ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼LSB)',
        'chaos_out_2': '0â†’0â†’1â†’1â†’0... (ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼MSB)', 
        'chaos_out_3': '0â†’1â†’1â†’0â†’0... (XORçµæœ)',
        'chaos_out_4': '0â†’0â†’0â†’1â†’0... (ANDçµæœ)'
      },
      frequency: '1Hzã‚¯ãƒ­ãƒƒã‚¯ã§2ç§’æ¯ã«çŠ¶æ…‹å¤‰åŒ–'
    },

    // æŠ€è¡“çš„ãªç‰¹å¾´
    technicalFeatures: [
      'D-FFå•é¡Œã‚’å›é¿ã—ãŸBINARY_COUNTERãƒ™ãƒ¼ã‚¹è¨­è¨ˆ',
      'å¾ªç’°ä¾å­˜ãªã—ã®å˜ç´”ãªè©•ä¾¡é †åº',
      'ç¢ºå®Ÿã«å‹•ä½œã™ã‚‹çµ„ã¿åˆã‚ã›è«–ç†',
      'ã‚†ã£ãã‚Šã¨ã—ãŸå‹•ä½œã§çŠ¶æ…‹å¤‰åŒ–ãŒè¦³å¯Ÿã—ã‚„ã™ã„',
      'XORã¨ANDã®çµ„ã¿åˆã‚ã›ã«ã‚ˆã‚‹è¤‡é›‘æ€§'
    ],

    // å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ
    learningPoints: [
      'ãƒã‚¤ãƒŠãƒªã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã®åŸºæœ¬å‹•ä½œ',
      'è«–ç†ã‚²ãƒ¼ãƒˆã®çµ„ã¿åˆã‚ã›ã«ã‚ˆã‚‹è¤‡é›‘æ€§å‰µç™º',
      'ç¢ºå®Ÿãªå›è·¯è¨­è¨ˆã®æ‰‹æ³•',
      'ã‚·ãƒ¼ã‚±ãƒ³ã‚·ãƒ£ãƒ«å›è·¯ã¨ã‚³ãƒ³ãƒ“ãƒãƒ¼ã‚·ãƒ§ãƒ³å›è·¯ã®é€£æº'
    ]
  }
};