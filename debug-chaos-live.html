<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŒ€ ã‚«ã‚ªã‚¹ç™ºç”Ÿå™¨ãƒ©ã‚¤ãƒ–ãƒ‡ãƒãƒƒã‚°</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #0a0a0a;
            color: #00ff88;
            margin: 0;
            padding: 20px;
        }
        .debug-panel {
            border: 2px solid #00ff88;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            background: rgba(0, 255, 136, 0.05);
        }
        .status-line {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #333;
        }
        .status-value {
            font-weight: bold;
        }
        .error { color: #ff4444; }
        .warning { color: #ffaa00; }
        .success { color: #00ff88; }
        .log-entry {
            padding: 2px 0;
            font-size: 12px;
        }
        .timestamp {
            color: #666;
        }
    </style>
</head>
<body>
    <h1>ğŸš¨ ã‚«ã‚ªã‚¹ç™ºç”Ÿå™¨ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–</h1>
    <p>ã“ã®ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚«ã‚ªã‚¹ç™ºç”Ÿå™¨ã‚’é–‹ãã€å•é¡Œã®å†ç¾ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</p>
    
    <div class="debug-panel">
        <h3>ğŸ“Š CLOCKã‚²ãƒ¼ãƒˆç›£è¦–</h3>
        <div id="clock-status"></div>
    </div>
    
    <div class="debug-panel">
        <h3>ğŸ’¡ å‡ºåŠ›ã‚²ãƒ¼ãƒˆçŠ¶æ…‹</h3>
        <div id="output-status"></div>
    </div>
    
    <div class="debug-panel">
        <h3>âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–</h3>
        <div id="performance-status"></div>
    </div>
    
    <div class="debug-panel">
        <h3>ğŸ”„ è©•ä¾¡ãƒ­ã‚°</h3>
        <div id="evaluation-log"></div>
    </div>
    
    <div class="debug-panel">
        <h3>ğŸ› ï¸ ãƒ‡ãƒãƒƒã‚°ã‚³ãƒ¼ãƒ‰ï¼ˆã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«è²¼ã‚Šä»˜ã‘ï¼‰</h3>
        <textarea readonly style="width: 100%; height: 300px; background: #111; color: #00ff88; border: 1px solid #333; font-family: 'Courier New', monospace;">
// ğŸš¨ ã‚«ã‚ªã‚¹ç™ºç”Ÿå™¨ãƒ‡ãƒãƒƒã‚°ã‚³ãƒ¼ãƒ‰
// ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ä»¥ä¸‹ã‚’ã‚³ãƒ”ãƒ¼&ãƒšãƒ¼ã‚¹ãƒˆã—ã¦ãã ã•ã„

(() => {
    console.log('ğŸŒ€ ã‚«ã‚ªã‚¹ç™ºç”Ÿå™¨ãƒ‡ãƒãƒƒã‚°é–‹å§‹');
    
    let isMonitoring = true;
    let logCount = 0;
    const maxLogs = 50;
    
    // ãƒ­ã‚°é–¢æ•°
    function debugLog(message, type = 'info') {
        const timestamp = new Date().toLocaleTimeString();
        const prefix = type === 'error' ? 'âŒ' : type === 'warning' ? 'âš ï¸' : 'ğŸ“';
        console.log(`${prefix} [${timestamp}] ${message}`);
        
        logCount++;
        if (logCount > maxLogs) {
            console.clear();
            logCount = 0;
        }
    }
    
    // çŠ¶æ…‹ç›£è¦–é–¢æ•°
    function monitorCircuitState() {
        if (!isMonitoring) return;
        
        try {
            // Zustandã‚¹ãƒˆã‚¢ã®å–å¾—ã‚’è©¦è¡Œ
            const storeElements = document.querySelectorAll('[data-testid], [class*="canvas"], canvas');
            
            if (storeElements.length === 0) {
                debugLog('å›è·¯ã‚­ãƒ£ãƒ³ãƒã‚¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'warning');
                return;
            }
            
            // React DevToolsçµŒç”±ã§ã®ã‚¹ãƒˆã‚¢å–å¾—
            const reactRoot = document.querySelector('#root');
            if (reactRoot && reactRoot._reactInternalFiber) {
                debugLog('Reactå†…éƒ¨çŠ¶æ…‹ã«ã‚¢ã‚¯ã‚»ã‚¹ä¸­...');
            }
            
            // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰çŠ¶æ…‹ç¢ºèª
            const storedState = localStorage.getItem('circuit-store');
            if (storedState) {
                const parsed = JSON.parse(storedState);
                debugLog(`ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸çŠ¶æ…‹: ${Object.keys(parsed.state || {}).length}å€‹ã®ã‚­ãƒ¼`);
            }
            
            // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–
            const memInfo = performance.memory;
            if (memInfo) {
                const usedMB = Math.round(memInfo.usedJSHeapSize / 1024 / 1024);
                const totalMB = Math.round(memInfo.totalJSHeapSize / 1024 / 1024);
                debugLog(`ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: ${usedMB}MB / ${totalMB}MB`);
            }
            
            // AnimationFrame ã®çŠ¶æ…‹ç¢ºèª
            const now = performance.now();
            debugLog(`AnimationFrameæ™‚åˆ»: ${now.toFixed(2)}ms`);
            
        } catch (error) {
            debugLog(`ç›£è¦–ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
        }
    }
    
    // CLOCKã‚²ãƒ¼ãƒˆç‰¹åŒ–ç›£è¦–
    function monitorClockGates() {
        try {
            // DOMä¸Šã®CLOCKã‚²ãƒ¼ãƒˆè¦ç´ ã‚’æ¢ã™
            const clockElements = document.querySelectorAll('[data-gate-type="CLOCK"], [class*="clock"]');
            debugLog(`DOMä¸Šã®CLOCKã‚²ãƒ¼ãƒˆè¦ç´ : ${clockElements.length}å€‹`);
            
            clockElements.forEach((element, index) => {
                const rect = element.getBoundingClientRect();
                const isVisible = rect.width > 0 && rect.height > 0;
                debugLog(`CLOCK ${index}: è¡¨ç¤º=${isVisible}, ä½ç½®=(${rect.x.toFixed(0)}, ${rect.y.toFixed(0)})`);
            });
            
        } catch (error) {
            debugLog(`CLOCKã‚²ãƒ¼ãƒˆç›£è¦–ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
        }
    }
    
    // å‡ºåŠ›ã‚²ãƒ¼ãƒˆç›£è¦–
    function monitorOutputGates() {
        try {
            const outputElements = document.querySelectorAll('[data-gate-type="OUTPUT"], [class*="output"]');
            let activeOutputs = 0;
            
            outputElements.forEach((element, index) => {
                const isActive = element.classList.contains('active') || 
                                element.style.fill === '#00ff88' ||
                                element.getAttribute('data-active') === 'true';
                if (isActive) activeOutputs++;
            });
            
            debugLog(`å‡ºåŠ›ã‚²ãƒ¼ãƒˆ: ${activeOutputs}/${outputElements.length} ãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–`);
            
            if (outputElements.length > 0 && activeOutputs === 0) {
                debugLog('ğŸš¨ å…¨å‡ºåŠ›ã‚²ãƒ¼ãƒˆãŒéã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ï¼', 'error');
            }
            
        } catch (error) {
            debugLog(`å‡ºåŠ›ã‚²ãƒ¼ãƒˆç›£è¦–ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
        }
    }
    
    // ã‚¨ãƒ©ãƒ¼ç›£è¦–
    const originalError = console.error;
    console.error = function(...args) {
        debugLog(`ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚¨ãƒ©ãƒ¼: ${args.join(' ')}`, 'error');
        originalError.apply(console, args);
    };
    
    // ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ—
    function mainLoop() {
        if (!isMonitoring) return;
        
        monitorCircuitState();
        monitorClockGates();
        monitorOutputGates();
        
        setTimeout(mainLoop, 2000); // 2ç§’é–“éš”
    }
    
    // é–‹å§‹
    debugLog('ç›£è¦–é–‹å§‹ï¼ã‚«ã‚ªã‚¹ç™ºç”Ÿå™¨ã‚’é–‹ã„ã¦å•é¡Œã‚’å†ç¾ã—ã¦ãã ã•ã„');
    mainLoop();
    
    // åœæ­¢ç”¨
    window.stopChaosDebug = () => {
        isMonitoring = false;
        debugLog('ç›£è¦–åœæ­¢', 'warning');
    };
    
    // æ‰‹å‹•çŠ¶æ…‹ç¢ºèªç”¨
    window.checkChaosState = () => {
        debugLog('=== æ‰‹å‹•çŠ¶æ…‹ç¢ºèª ===');
        monitorCircuitState();
        monitorClockGates();
        monitorOutputGates();
    };
    
    console.log('ğŸ› ï¸ åœæ­¢: stopChaosDebug()');
    console.log('ğŸ” æ‰‹å‹•ç¢ºèª: checkChaosState()');
})();
        </textarea>
    </div>
    
    <div class="debug-panel">
        <h3>ğŸ“‹ ç›£è¦–æ‰‹é †</h3>
        <ol>
            <li>ä¸Šè¨˜ã®ãƒ‡ãƒãƒƒã‚°ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼</li>
            <li>ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚«ã‚ªã‚¹ç™ºç”Ÿå™¨ã‚’é–‹ãï¼ˆã‚®ãƒ£ãƒ©ãƒªãƒ¼ãƒ¢ãƒ¼ãƒ‰ã¾ãŸã¯ä½œæˆãƒ¢ãƒ¼ãƒ‰ï¼‰</li>
            <li>é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ï¼ˆF12ï¼‰ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚¿ãƒ–ã‚’é–‹ã</li>
            <li>ãƒ‡ãƒãƒƒã‚°ã‚³ãƒ¼ãƒ‰ã‚’è²¼ã‚Šä»˜ã‘ã¦å®Ÿè¡Œ</li>
            <li>å•é¡ŒãŒç™ºç”Ÿã™ã‚‹ã¾ã§å¾…æ©Ÿï¼ˆ2ç§’é–“éš”ã§è‡ªå‹•ç›£è¦–ï¼‰</li>
            <li>å‡ºåŠ›ãŒåœæ­¢ã—ãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®ãƒ­ã‚°ã‚’ç¢ºèª</li>
        </ol>
    </div>
    
    <script>
        // ã“ã®ãƒšãƒ¼ã‚¸ã§ã¯å®Ÿéš›ã®ç›£è¦–ã¯è¡Œã‚ãšã€æ‰‹é †ã‚’è¡¨ç¤ºã™ã‚‹ã®ã¿
        document.addEventListener('DOMContentLoaded', function() {
            const clockStatus = document.getElementById('clock-status');
            const outputStatus = document.getElementById('output-status');
            const performanceStatus = document.getElementById('performance-status');
            const evaluationLog = document.getElementById('evaluation-log');
            
            clockStatus.innerHTML = '<div class="status-line"><span>ã“ã®ãƒšãƒ¼ã‚¸ã¯ç›£è¦–ãƒ„ãƒ¼ãƒ«ã§ã™</span><span class="warning">å®Ÿéš›ã®ç›£è¦–ã¯ä¸Šè¨˜ã‚³ãƒ¼ãƒ‰ã‚’ä½¿ç”¨</span></div>';
            outputStatus.innerHTML = '<div class="status-line"><span>ã‚«ã‚ªã‚¹ç™ºç”Ÿå™¨ã‚’é–‹ã„ã¦ãƒ‡ãƒãƒƒã‚°ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„</span></div>';
            performanceStatus.innerHTML = '<div class="status-line"><span>ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§è©³ç´°ãƒ­ã‚°ã‚’ç¢ºèª</span></div>';
            evaluationLog.innerHTML = '<div class="log-entry"><span class="timestamp">[å¾…æ©Ÿä¸­]</span> ãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«æº–å‚™å®Œäº†</div>';
        });
    </script>
</body>
</html>