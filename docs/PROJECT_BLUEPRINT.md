# 🎯 LogiCirc - プロジェクト設計書

> 誰でも楽しく論理回路からCPUまで学べる、直感的な教育プラットフォーム

## 📋 目次
1. [プロジェクト概要](#プロジェクト概要)
2. [コア機能](#コア機能)
3. [アーキテクチャ](#アーキテクチャ)
4. [UI/UXデザイン](#uiuxデザイン)
5. [技術スタック](#技術スタック)
6. [開発ロードマップ](#開発ロードマップ)
7. [品質基準](#品質基準)

---

## 🎯 プロジェクト概要

### ビジョン
論理回路の基礎から始まり、最終的にCPU設計まで到達できる、インタラクティブな学習プラットフォーム。「楽しさファースト」で、誰でも直感的に理解できる設計。

### コアバリュー
- **楽しさファースト**: まず触って楽しい、理解は後から
- **段階的学習**: 小さな成功体験の積み重ね
- **実用的理解**: 身近な例で「なるほど！」を提供
- **創造的発見**: 自由な実験と発見の場

### ターゲットユーザー
- プログラミング初心者
- 情報系の学生
- 電子工作に興味がある人
- 教育者

---

## 🎮 コア機能

### 4つのモード

#### 1. 学習モード 📚【実装済み】
段階的なチュートリアルで基礎から学習
- 構造化された22レッスン（18レッスンがproduction品質、4レッスンがbeta品質）
- 7ステップ構成（導入→原理→回路作成→実験→分析→応用→まとめ）
- インタラクティブな説明と実践
- 統一された用語（TERMS）使用

#### 2. フリーモード 🎨【実装済み】
制限なしの創作空間
- 無限キャンバス
- 全ゲート利用可能
- カスタムゲート作成機能
- URL共有機能（Base64エンコード）
- 真理値表自動生成
- キーボードショートカット対応

#### 3. パズルモード 🧩【実装済み】
ゲーム感覚で実力向上
- 難易度別の問題セット
- リアルタイム検証
- ヒントシステム
- 進捗管理

#### 4. ギャラリーモード 🎭【実装済み】
サンプル回路の閲覧と学習
- 基本回路から高度な回路まで
- 動作説明付き
- 自由に編集・実験可能

### ゲート一覧

#### 基本ゲート（70×50px）
- AND, OR, NOT
- XOR, NAND, NOR, XNOR

#### 入出力
- INPUT（スイッチ）
- OUTPUT（LED）
- CLOCK（円形、特殊形状）

#### 特殊ゲート（100×80px）
- D-FF（Dフリップフロップ）
- SR-Latch
- MUX（マルチプレクサ）
- Register（4ビット）

#### カスタムゲート
- ユーザー作成の再利用可能な回路
- アイコンと名前をカスタマイズ可能

### 主要機能【実装済み】
- **リアルタイムシミュレーション**: coreAPIによる高速・型安全な回路評価
- **ドラッグ&ドロップ配置**: ツールパレットから直感的に配置
- **スマート接続**: ピンクリックで簡単配線、エラー時の視覚フィードバック
- **真理値表**: 自動生成と表示、カスタムゲートにも対応
- **URL共有**: Base64エンコードによる即座の回路共有
- **レスポンシブ対応**: PC/タブレット/スマホそれぞれに最適化
- **カスタムゲート作成**: 既存の回路から新しいゲートを作成
- **キーボードショートカット**: Delete、Undo/Redo、Copy/Paste、SelectAll
- **プロパティパネル**: ゲート情報と学習リソースの統合表示
- **エラー通知**: トースト形式の分かりやすいエラー表示

---

## 🏗️ アーキテクチャ

### 採用アーキテクチャ: Hybrid Feature-Domain Architecture

#### なぜこのアーキテクチャか？
- プロジェクト規模に適した複雑さ
- UI層とビジネスロジック層の明確な分離
- 既存の良い設計（entities）を活用
- 保守性と実装の容易さのバランス

### ディレクトリ構造（実装済み）
```
src/
├── 🎨 features/                 # 機能単位のUI層
│   ├── gallery/                 # ギャラリーモード
│   ├── learning-mode/           # 学習モード（22レッスン）
│   │   ├── components/          # レッスン表示コンポーネント
│   │   ├── data/               # レッスンデータと品質管理
│   │   └── ui/                 # UI実装
│   └── puzzle-mode/            # パズルモード
│
├── 🔧 domain/                   # ビジネスロジック層
│   ├── analysis/                # 回路分析（真理値表生成など）
│   ├── circuit/                 # 回路操作
│   └── simulation/             # シミュレーションエンジン
│       └── core/               # coreAPI（Result<T,E>パターン）
│
├── 🏪 stores/                   # グローバル状態管理（Zustand）
│   ├── circuitStore.ts         # ストア統合
│   └── slices/                 # 機能別スライス（10種類）
│
├── 🎯 components/               # UIコンポーネント
│   ├── dialogs/                # ダイアログ群
│   ├── gate-renderers/         # ゲート描画
│   ├── layouts/                # レスポンシブレイアウト
│   └── property-panel/         # プロパティパネル
│
├── 🔨 hooks/                    # カスタムフック
├── 📂 services/                 # ビジネスサービス
├── 🎨 styles/                   # スタイルシート
├── 📝 types/                    # 型定義
└── App.tsx                     # アプリケーションエントリ
```

### 状態管理（実装済み）
- **Zustand**: グローバル状態管理（10個のスライスで機能分離）
  - appModeSlice: アプリモード管理
  - selectionSlice: 選択状態
  - gateOperations: ゲート操作
  - wireOperations: ワイヤー操作
  - clipboardSlice: コピー&ペースト
  - historySlice: Undo/Redo
  - customGateSlice: カスタムゲート
  - errorSlice: エラーメッセージ
  - shareSlice: 回路共有
  - toolPaletteSlice: ツール選択
- **ローカル状態**: useState + カスタムフック
- **ビジネスロジック**: domain層に集約（coreAPI）

### 重要な設計判断
1. **統一された当たり判定**: `CollisionDetector`クラスで一元管理
2. **ゲート描画の統一**: `GateRenderer`で全ゲートを描画
3. **ピンの○─形式**: 視認性とクリック性を向上
4. **レスポンシブファースト**: モバイルでも快適な操作

---

## 🎨 UI/UXデザイン

### デザインシステム
- **ダークテーマ**: 目に優しい黒背景（#0a0a0a）
- **アクセントカラー**: 鮮やかな緑（#00ff88）
- **グラスモーフィズム**: 半透明とぼかし効果
- **アニメーション**: 滑らかな60fps

### ゲートデザイン仕様
```
基本ゲート: 70×50px、角丸8px
特殊ゲート: 100×80px、角丸8px
カスタムゲート: 100×可変高さ
CLOCK: 円形（半径40px）

ピン仕様:
- 形式: ○─（円と線）
- 円の半径: 6px
- ヒットエリア: 半径20px（モバイル30px）
- 位置:
  - INPUT出力: x=35
  - OUTPUT入力: x=-30
  - 標準ゲート: x=±45
  - 特殊ゲート: x=±60
```

### レイアウト

#### PC版（3カラム）
- 左: ツールパレット（280px）
- 中央: キャンバス（可変）
- 右: プロパティパネル（320px）

#### モバイル版
- 上部: ヘッダー（固定）
- 中央: キャンバス（全画面）
- 下部: ボトムシート型ツール

### インタラクション
- **ワンクリック配置**: ツールパレットから即座に配置
- **クリック/タップ**: 選択、接続、INPUTトグル
- **ドラッグ**: 配置済みゲートの位置調整
- **ピンチズーム**: キャンバス拡大縮小（モバイル）
- **パン**: キャンバス移動

#### 操作フロー（実装済み）
1. **ゲート配置**: ツールパレットからドラッグ&ドロップで配置
2. **接続**: ピンをクリック → 別のピンをクリック → ワイヤー自動生成
3. **位置調整**: 配置済みゲートをドラッグで移動
4. **削除**: ゲート選択 → Deleteキー（またはゴミ箱ボタン）
5. **コピー&ペースト**: Ctrl/Cmd+C → Ctrl/Cmd+V
6. **Undo/Redo**: Ctrl/Cmd+Z → Ctrl/Cmd+Shift+Z
7. **全選択**: Ctrl/Cmd+A
8. **キャンセル**: Escape（接続中断など）

---

## 🛠️ 技術スタック

### フロントエンド
- **React 18**: UIフレームワーク
- **TypeScript**: 型安全性（strict mode）
- **Vite**: 高速ビルドツール
- **Zustand**: 状態管理（シンプルで高速）

### スタイリング
- **Tailwind CSS**: ユーティリティファースト
- **CSS Modules**: コンポーネントスコープ

### テスト
- **Vitest**: 単体テスト
- **React Testing Library**: コンポーネントテスト
- **Cypress**: E2Eテスト

### 開発ツール
- **ESLint**: コード品質
- **Prettier**: コードフォーマット
- **Husky**: Git hooks

---


## 📅 開発フェーズ

### Phase 0: 基本機能の確立【✅ 完了】
- ドラッグ&ドロップ配置
- 座標変換の実装
- 接続線描画
- レスポンシブデザイン

### Phase 1: アーキテクチャ整理【✅ 完了】
- coreAPI設計（Result<T,E>パターン）
- ドメイン層の整理
- 状態管理の最適化
- カスタムゲート機能
- 真理値表自動生成

### Phase 2: UI/UX改善【🚧 80%完了】
- 学習モード統一（18/22レッスンがproduction品質、4レッスンがbeta品質）
- プロパティパネル強化
- エラーハンドリング
- キーボードショートカット
- 回路共有URL

### Phase 3: 次世代機能【計画中】
- タイミングチャート & 波形解析
- バージョン管理システム
- 回路ライブラリ & テンプレート
- AIアシスタント
- リアルタイムコラボレーション

---

## 📊 品質基準

### 必須達成項目
- **TypeScript**: strict mode、エラー0
- **テスト**: カバレッジ80%以上
- **ビルド**: エラー0、警告最小化
- **パフォーマンス**: 60fps維持

### パフォーマンス目標
- 初回読み込み: 3秒以内
- ゲート1000個: 30fps以上
- メモリ使用量: 200MB以下

### アクセシビリティ
- キーボード操作対応
- スクリーンリーダー対応
- 高コントラストモード

### ブラウザ対応
- Chrome/Edge（最新2バージョン）
- Firefox（最新2バージョン）
- Safari（最新2バージョン）
- モバイルブラウザ

---

## 🚀 開始方法

```bash
# 開発環境セットアップ
npm install

# 開発サーバー起動
npm run dev

# テスト実行
npm run test              # 単体テスト
npm run test:e2e          # E2Eテスト

# ビルド
npm run build

# 品質チェック（必須）
npm run typecheck         # TypeScriptチェック
npm run lint              # ESLintチェック
npm run test              # テスト実行
npm run build             # ビルド確認
```

---

## 📝 関連ドキュメント

### 必須ドキュメント
- `development/GUIDELINES.md`: 開発ルールと品質基準
- `README.md`: プロジェクト概要
- 本ドキュメント: 設計の全体像

### 参考資料
- `design/mockups/final-gate-design.html`: ゲートデザイン仕様
- `design/mockups/mobile-ui.html`: モバイルUI
- `design/mockups/desktop-ui.html`: デスクトップUI

---

## 🎯 成功の定義

### 段階的な成長戦略
- 基本機能の確実な動作
- コンテンツの充実による学習価値の向上
- ユーザビリティの継続的改善

### 拡張の方向性
- 高度な回路設計への対応
- コミュニティ機能の検討
- 教育現場での活用促進

### 将来的なビジョン
- CPUアーキテクチャまでの学習パス
- 実際の教育現場での採用
- 多言語対応による国際展開

---

*このドキュメントはプロジェクトの進行に応じて更新されます。*