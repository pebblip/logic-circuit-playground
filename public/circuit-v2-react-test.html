<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CircuitDiagramRendererV2 Reactãƒ†ã‚¹ãƒˆ</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background-color: #1a1b26;
      color: #e8e8ec;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    h1 {
      color: #00ff88;
      margin-bottom: 30px;
    }

    /* å›è·¯ã‚¹ã‚¿ã‚¤ãƒ« */
    .circuit-diagram-v2 {
      background-color: #24253a;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 30px;
    }

    .circuit-title {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 20px;
      color: #00ff88;
    }

    .lesson-circuit-svg {
      width: 100%;
      max-width: 800px;
      height: auto;
      background-color: #2a2b3d;
      border-radius: 8px;
    }

    /* ã‚²ãƒ¼ãƒˆã‚¹ã‚¿ã‚¤ãƒ« */
    .gate {
      cursor: pointer;
    }

    .gate-body {
      fill: #363849;
      stroke: #00ff88;
      stroke-width: 2;
    }

    .gate-label {
      fill: #e8e8ec;
      font-size: 14px;
      font-weight: bold;
      text-anchor: middle;
      dominant-baseline: middle;
    }

    /* ãƒ¯ã‚¤ãƒ¤ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ« */
    .wire {
      fill: none;
      stroke: #565869;
      stroke-width: 3;
    }

    .wire.active {
      stroke: #00ff88;
    }

    /* ãƒ”ãƒ³ã‚¹ã‚¿ã‚¤ãƒ« */
    .gate-pin {
      fill: #00ff88;
      stroke: none;
    }

    .gate-pin-line {
      stroke: #00ff88;
      stroke-width: 2;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ§ª CircuitDiagramRendererV2 - Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆ</h1>
    <div id="root"></div>
  </div>

  <script type="text/babel">
    // ç°¡æ˜“ç‰ˆã®ã‚²ãƒ¼ãƒˆãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼
    const GateRenderer = ({ gate }) => {
      const renderGateBody = () => {
        switch (gate.type) {
          case 'INPUT':
            return (
              <g className="gate input-gate">
                <rect className="gate-body" x="-35" y="-25" width="70" height="50" rx="8" />
                <text className="gate-label" x="0" y="0">{gate.id === 'input-a' ? 'A' : 'B'}</text>
                <circle className="gate-pin" cx="35" cy="0" r="5" />
              </g>
            );
          case 'OUTPUT':
            return (
              <g className="gate output-gate">
                <rect className="gate-body" x="-35" y="-25" width="70" height="50" rx="8" />
                <text className="gate-label" x="0" y="0">{gate.id === 'output-sum' ? 'Sum' : 'Carry'}</text>
                <line className="gate-pin-line" x1="-35" y1="0" x2="-45" y2="0" />
                <circle className="gate-pin" cx="-45" cy="0" r="5" />
              </g>
            );
          case 'XOR':
          case 'AND':
            return (
              <g className={`gate ${gate.type.toLowerCase()}-gate`}>
                <rect className="gate-body" x="-35" y="-25" width="70" height="50" rx="8" />
                <text className="gate-label" x="0" y="0">{gate.type}</text>
                {/* å…¥åŠ›ãƒ”ãƒ³ */}
                <line className="gate-pin-line" x1="-35" y1="-10" x2="-45" y2="-10" />
                <circle className="gate-pin" cx="-45" cy="-10" r="5" />
                <line className="gate-pin-line" x1="-35" y1="10" x2="-45" y2="10" />
                <circle className="gate-pin" cx="-45" cy="10" r="5" />
                {/* å‡ºåŠ›ãƒ”ãƒ³ */}
                <line className="gate-pin-line" x1="35" y1="0" x2="45" y2="0" />
                <circle className="gate-pin" cx="45" cy="0" r="5" />
              </g>
            );
          default:
            return null;
        }
      };

      return (
        <g transform={`translate(${gate.position.x}, ${gate.position.y})`}>
          {renderGateBody()}
        </g>
      );
    };

    // ç°¡æ˜“ç‰ˆã®ãƒ¯ã‚¤ãƒ¤ãƒ¼ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼
    const WireRenderer = ({ wire, gates }) => {
      const fromGate = gates.find(g => g.id === wire.from.gateId);
      const toGate = gates.find(g => g.id === wire.to.gateId);

      if (!fromGate || !toGate) return null;

      // ç°¡æ˜“çš„ãªãƒ”ãƒ³ä½ç½®è¨ˆç®—
      let fromX = fromGate.position.x;
      let fromY = fromGate.position.y;
      let toX = toGate.position.x;
      let toY = toGate.position.y;

      // å‡ºåŠ›ãƒ”ãƒ³ä½ç½®èª¿æ•´
      if (fromGate.type === 'INPUT') {
        fromX += 35;
      } else if (fromGate.type === 'XOR' || fromGate.type === 'AND') {
        fromX += 45;
      }

      // å…¥åŠ›ãƒ”ãƒ³ä½ç½®èª¿æ•´
      if (toGate.type === 'OUTPUT') {
        toX -= 45;
      } else if (toGate.type === 'XOR' || toGate.type === 'AND') {
        toX -= 45;
        toY += wire.to.pinIndex === 0 ? -10 : 10;
      }

      // ãƒ™ã‚¸ã‚§æ›²ç·šãƒ‘ã‚¹
      const midX = (fromX + toX) / 2;
      const path = `M ${fromX} ${fromY} Q ${midX} ${fromY} ${midX} ${(fromY + toY) / 2} T ${toX} ${toY}`;

      return (
        <path 
          className={`wire ${wire.isActive ? 'active' : ''}`} 
          d={path}
        />
      );
    };

    // ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
    const CircuitDiagramV2Test = () => {
      // åŠåŠ ç®—å™¨ã®å›è·¯ãƒ‡ãƒ¼ã‚¿
      const circuit = {
        title: 'åŠåŠ ç®—å™¨å›è·¯ï¼ˆReactç‰ˆï¼‰',
        gates: [
          { id: 'input-a', type: 'INPUT', position: { x: 100, y: 150 }, inputs: [], output: true },
          { id: 'input-b', type: 'INPUT', position: { x: 100, y: 250 }, inputs: [], output: true },
          { id: 'xor-gate', type: 'XOR', position: { x: 350, y: 120 }, inputs: [], output: false },
          { id: 'and-gate', type: 'AND', position: { x: 350, y: 280 }, inputs: [], output: false },
          { id: 'output-sum', type: 'OUTPUT', position: { x: 550, y: 120 }, inputs: [] },
          { id: 'output-carry', type: 'OUTPUT', position: { x: 550, y: 280 }, inputs: [] },
        ],
        wires: [
          { id: 'w1', from: { gateId: 'input-a', pinIndex: -1 }, to: { gateId: 'xor-gate', pinIndex: 0 }, isActive: true },
          { id: 'w2', from: { gateId: 'input-b', pinIndex: -1 }, to: { gateId: 'xor-gate', pinIndex: 1 }, isActive: false },
          { id: 'w3', from: { gateId: 'input-a', pinIndex: -1 }, to: { gateId: 'and-gate', pinIndex: 0 }, isActive: true },
          { id: 'w4', from: { gateId: 'input-b', pinIndex: -1 }, to: { gateId: 'and-gate', pinIndex: 1 }, isActive: false },
          { id: 'w5', from: { gateId: 'xor-gate', pinIndex: -1 }, to: { gateId: 'output-sum', pinIndex: 0 }, isActive: true },
          { id: 'w6', from: { gateId: 'and-gate', pinIndex: -1 }, to: { gateId: 'output-carry', pinIndex: 0 }, isActive: false },
        ]
      };

      return (
        <div className="circuit-diagram-v2">
          <h3 className="circuit-title">{circuit.title}</h3>
          <svg 
            viewBox="0 0 700 400" 
            className="lesson-circuit-svg"
          >
            {/* ãƒ¯ã‚¤ãƒ¤ãƒ¼ã‚’å…ˆã«æç”» */}
            <g className="wires">
              {circuit.wires.map(wire => (
                <WireRenderer key={wire.id} wire={wire} gates={circuit.gates} />
              ))}
            </g>
            
            {/* ã‚²ãƒ¼ãƒˆã‚’å¾Œã«æç”» */}
            <g className="gates">
              {circuit.gates.map(gate => (
                <GateRenderer key={gate.id} gate={gate} />
              ))}
            </g>
          </svg>
          
          <div style={{ marginTop: '20px', padding: '15px', backgroundColor: '#1e1f2e', borderRadius: '8px' }}>
            <p>âœ… Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã—ã¦æ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã™</p>
            <p>âœ… A=1, B=0 ã®å ´åˆ: Sum=1, Carry=0ï¼ˆç·‘ã®ãƒ¯ã‚¤ãƒ¤ãƒ¼ãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–ï¼‰</p>
          </div>
        </div>
      );
    };

    // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<CircuitDiagramV2Test />);
  </script>
</body>
</html>